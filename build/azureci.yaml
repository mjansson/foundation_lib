trigger:
- master

pr:
- master
- develop

pool:
  vmImage: 'VS2017-Win2016'

steps:
- task: NuGetToolInstaller@0

- script: |
    nuget.exe sources Add -Name "Tools" -Source "https://mjansson.pkgs.visualstudio.com/_packaging/Tools/nuget/v2" -Username mjansson -Password $(System.AccessToken)
  displayName: 'nuget setup'

- script: |
    nuget.exe install ninja -Source "Tools" -ExcludeVersion
  displayName: 'install ninja'

- script: |
    python configure.py
  displayName: 'configure'

- script: |
    ninja\ninja.exe
  displayName: 'build'

#- script: |
#    bin\windows\debug\x86-64\test-all.exe
#  displayName: 'run tests (debug)'

- script: |
    bin\windows\release\x86-64\test-all.exe
  displayName: 'run tests (release)'

- script: |
    bin\windows\deploy\x86-64\test-all.exe
  displayName: 'run tests (deploy)'
